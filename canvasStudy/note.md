## Canvas

### 大小设置

canvas 元素实际上有 2 套尺寸。一个是元素本身的大小，还有一个是元素绘图表面的大小(默认值：300 x 150)

当`canvas`元素的大小不符合其绘图表面的大小时，浏览器就会对绘图表面进行缩放，使其符合元素的大小

1. `CSS`
   > 只会改变元素本身的大小，不会影响到绘图表面
2. 属性设置 
   
    同时修改了该元素本身的大小与元素绘图表面的大小 <br />
   
    ```
    canvas.width = "300"
    canvas.height = "300"
   ```

---

### 属性和方法

1. 属性

   | 属性   | 描述 | 类型     | 取值范围  | 默认值 |
   | ------ | ---- | -------- | --------- | ------ |
   | width  | ...  | 非负整数 | 不能加 px | 300    |
   | height | ...  | 非负整数 | 不能加 px | 300    |

2. 方法

   | 属性                            | 描述                                                                                                                                                                                                                                                                                                                                  |
   | ------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
   | getContext()                    | 返回与该`canvas`相关的绘图环境对象，每个`canvas`元素均有一个这样的环境对象，而且每个环境对象均与一个`canvas`元素相关联                                                                                                                                                                                                                |
   | toDataURL(type, quality)        | 返回一个数据地址(data URL), 你可以将它设定为`img`元素的属性值，第一个参数指定了图像的类型，例如`image/png`,如果不指定第一个参数，则默认使用`image/png`,第二个参数比巡视`0 ~ 1.0`之间的`double`值,它表示 JPEG 图像显示的质量                                                                                                           |
   | toBlob(callback, type, args...) | 创建一个用于表示此`canvas`元素图像文件的`Blob`。第一个参数是一个回调函数，浏览器会以一个指向`blob`的引用为参数，去调用该回调函数。第二个参数以"image/png"这样的形式来指定图像类型。如果不指定，则默认使用"image/png"。最后一个参数是介于`0.0 ~ 1.0`之间的值，表示 JPEG 图像的质量，将来很可能会加入其他一些用于精确调控图像属性的参数 |

---

## Canvas 的绘图环境

### 2d 绘图环境

| 属性                    | 简介                                                                                                                                                                           |
| ----------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| canvas                  | 指向该绘图环境所属的`canvas`对象。该属性最常见的用途就是通过它来获取`canvas`的宽度和高度，分别调用`context.canvas.width`与`context.canvas.height`即可                          |
| fillstyle               | 指定该绘图环境在后续的徒刑填充过程中所使用的颜色、渐变色或图案                                                                                                                 |
| font                    | 设定在调用绘图环境对象的`fillText()`或`strokeText()`方法时，所使用的字型                                                                                                       |
| globalAlpha             | 全局透明设定，他可以取`0(完全透明) ～ 1.0(完全不透明)`之间的值。浏览器会将每个像素的`alpha`值与该值相乘，在绘制图像时也是如此                                                  |
| globalCompsiteOperation | 该值决定了浏览器将某个物体绘制在其他物体之上时，所采用的绘制方式                                                                                                               |
| lineCap                 | 该值告诉浏览器如何绘制线段的端点。可以在一下三个值中指定一个: `butt`、`round`、`square`。默认值是`butt`                                                                        |
| lineWidth               | 该值决定了在`canvas`之中绘制线段的屏幕像素宽度。它必须是个非负、非无穷的`double`值。默认值是`1.0`                                                                              |
| lineJoin                | 告诉浏览器在两条线段相交时如何绘制焦点。可取的值是: `bevel`、`round`、`miter`。默认值是`miter`                                                                                 |
| miterLimit              | 告诉浏览器如何绘制`miter`形式的线段焦点                                                                                                                                        |
| shadowBlur              | 该值决定了浏览器该如何延伸阴影效果。值越高，阴影效果延伸的就越远。该值不是指阴影的像素长度，二十代表高斯模糊方程式中的参数值。它必须是一个非负且无穷量的 double 值。默认值是 0 |
| shadowColor             | 该值告诉浏览器使用何种颜色来绘制阴影。通常采用半透明色作为该属性的值，以便让后面的背景能显示出来                                                                               |
| shadowOffsetX           | 以像素为单位，指定了阴影效果的水平方向的偏移量                                                                                                                                 |
| shadowOffsetY           | 以像素为单位，指定了阴影效果的垂直方向的偏移量                                                                                                                                 |
| strokeStyle             | 指定了对路径进行描边时所用的绘制风格。该值可被设定为某个颜色、渐变色或者图案                                                                                                   |
| textAlign               | 决定了以`fillText()`或`strokeText()`方法进行绘制时，所画文本的水平对其方式                                                                                                     |
| textBaseline            | 决定了以`fillText()`或`strokeText()`方法进行绘制时，所画文本的垂直对齐方式                                                                                                     |

### `gloobalCompositeOperation`属性值

| 属性值           | 说明                                                                 |
| ---------------- | -------------------------------------------------------------------- |
| sourece-over     | 默认值，新图形覆盖旧图形                                             |
| copy             | 只显示新图形，旧图形作透明处理                                       |
| darker           | 2 种图形都显示，在重叠部分，颜色由 2 种图形的颜色值相减后形成        |
| destination-atop | 只显示新图形和旧图形重叠部分以及新图形的其余部分，其他部分作透明处理 |
| destination-in   | 只显示旧图形中与新图形重叠部分，其他部分作透明处理                   |
| desination-out   | 只显示旧图形中与新图形不重叠部分，其他部分作透明处理                 |
| destination-over | 与`source-over`属性相反，旧图形覆盖新图形                            |
| lighter          | 2 种图形都显示，在图形重叠部分，颜色由 2 种图形的颜色值相加后形成    |
| source-atop      | 只显示旧图形与新图像重叠部分及旧图形的其余部分，其他部分作透明处理   |
| source-in        | 只显示新图形中与旧图形重叠部分，其他部分作透明处理                   |
| source-out       | 只显示新图形中与旧图形不重叠部分，其他部分作透明处理                 |
| xor              | 2 种图形都绘制 其中重叠部分作透明处理                                
|

|

|||

## 绘制

### 矩形的绘制

1. 矩形的清除：`clearRect(double x, double y, double w, double h)`
2. 描边： `strokeRect(double x, double y, double w, double h)`
3. 填充：`fillRect(double x, double y, double w, double h)`
4. 绘制：`rect(x, y, width, height)` (注意：需要调用`context.stroke()`或者`context.fill()`才能绘制出来)

### 颜色与透明度

1. `context.strokeStyle = 'red'`
2. `context.fillStyle = 'rgba(0, 0, 255, 0.5)'`

### 渐变色与图案

1. 渐变

   | 方法                                                             | 描述                                                                                                                                                                                                                                                                                                                                   |
   | ---------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
   | createLinearGradient(double x0, double y0, double x1, double y1) | 创建线性渐变。传入该方法的参数表示渐变线的 2 个端点。该方法返回一个`CanvasGradient`实例，可以通过 CanvasGradient.addColorStop()方法来向该渐变色增加颜色停止点 <br /><br />x0 如果与 x1 相同，则表示沿着垂直方向从上到下渐变<br /> y0 === y1,表示沿着水平方向从左到右渐变<br /> x0 !== x1 && y0 !== y1,表示渐变色沿着矩形对角线方向渐变 |
   | createRadialGradient(x1, y1, r1, x2, y2, r2)                     | `(x1, y1)` 表示开始时圆心的坐标，`r1`表示渐变开始时圆的半径。<br /> `(x2, y2)` 表示渐变结束时圆心的坐标，`r2`表示渐变结束时圆的半径。                                                                                                                                                                                                  |

2. 图案

- `canvas`元素也允许使用图案来对图形和文本进行描边与填充。这里的图案可以是一下三种之一：`image`元素、`canvas`元素或`video`元素
- 可以用`createPattern()`方法来创建图案，该方法接受 2 个参数：图案本身，以及一个用来告知浏览器应该如何重复图案的字符串。第二个参数可以取如下的值：`repeat`、`repeat-x`或`no-repeat`

| 方法                                                                           | 描述                                                                                                                                                                                                                                                                                    |
| ------------------------------------------------------------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| createPattern(HTMLImageElement ｜ HTMLCanvasElement ｜ HTMLVideoElement image) | 创建一个可以用来在`canvas`之中对图形和文本进行描边与填充的图案。该方法的第一个参数指定了图案所用的图像，它可以是`image`元素、`canvas`元素或者`video`元素。第二个参数，在对图形进行描边或填充时，应该如何重复该图案。这饿个参数的有效取值是`repeat`、`repeat-x`、`repeat-y`、`no-repeat` |

### 阴影

4 个属性值来指定阴影效果

- `shadowColor`: CSS3 格式的颜色
- `shadowOffsetX`: 从图形或文本到阴影的水平像素偏移
- `shadowOffsetY`: 从图形或文本到阴影的垂直像素偏移
- `shadowBlur`: 一个与像素无关的值。该值被用于高斯模糊方程之中，以便对阴影进行模糊化处理

> 满足以下条件，那么使用 canvass 的绘图环境对象就可以绘制出阴影效果了<br />
>
> 1.  指定的`shadowColor`值不是全透明
> 2.  在其余的阴影属性中，存在一个非 0 的值

### 路径、描边与填充

- 路径

  | 方法                                                  | 描述                                                                                                                                                                                                                                                     |
  | ----------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
  | arc(x, y, r, sAngle, eAngle, counterclockwise)        | x => 圆的中心的 x 坐标 <br />y => 圆的中心的 y 坐标 <br /> r => 圆的半径 <br /> sAngle => 起始角，以弧度计。(弧的圆形的三点钟位置是 0 度) <br /> eAngle => 结束角，以弧度计 <br /> counterclockwise => 可选，规定是逆时针还是顺时针绘图。 false = 顺时针 |
  | beginPath()                                           | 将当前路径之中的所有子路径都清除掉，以此来重置当前路径。在需要开始一段新的路径时，应该调用此方法                                                                                                                                                         |
  | closePath()                                           | 显示的封闭某段开放路径。该方法用于封闭圆弧路径以及由曲线或线段所创建的开放路径                                                                                                                                                                           |
  | fill()                                                | 使用 fillStyle 对当前路径的内部进行填充                                                                                                                                                                                                                  |
  | rect(double x, double y, double width, double height) | 在坐标(x, y)处建立一个宽度为 width、高度为 height 的矩形子路径。该子路径一定是封闭的，而且总是按逆时针方向来创建的                                                                                                                                       |
  | stroke()                                              | 使用`strokeStyle`来描绘当前路径的轮廓线                                                                                                                                                                                                                  |
  | isPointInPath(x, y)                                   | 判断某一个点是否存在与当前的路径中 <br /><br />如果点`(x, y)`位于当前路径中，返回`true`;如果点`(x, y)`不位于当前路径中，返回`false` <br /><br />注意，`isPointInPath()`不支持 Canvas 自带的 2 个方法`strokeRect()`和`fillRect()`，只能使用`rect()`代替   |

* 线段

  | 方法         | 描述                                                                                                             |
  | ------------ | ---------------------------------------------------------------------------------------------------------------- |
  | moveTo(x, y) | 向当前路径中增加一条子路径，该子路径只包含一个点，就是由参数传入的那个点。该方法并不会从当前路径中清除任何子路径 |
  | lineTo(x ,y) | 如果当前路径中没有子路径，方法同上。如果有，那个该方法会将你所指定的那个点加入子路径中                           |

- `canvas.、("2d")`对象中与线段绘制有关的属性

  | 属性       | 描述                                                                                                  | 类型      | 取值范围            | 默认值 |
  | ---------- | ----------------------------------------------------------------------------------------------------- | --------- | ------------------- | ------ |
  | lineWidth  | 以像素为单位的线段宽度                                                                                | double    | 非零的整数          | 1.0    |
  | lineCap    | 该值决定浏览器如何绘制线段的端点                                                                      | DOMString | butt、round、square | butt   |
  | lineJoin   | 该值决定浏览器如何绘制线段的连接点                                                                    | DOMString | round、bevel、miter | bevel  |
  | miterLimit | 斜接线长度与二分之一线宽的比值。如果斜接线的长度超过了该值，浏览器就会以`bevel`方式来绘制线段的连接点 | double    | 非零的正数          | 10.0   |

* 绘制圆弧及圆形的方法

  | 方法                                                                                                  | 描述                                                                                                                                                                                                                                                                                                             |
  | ----------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
  | arc(double x, double y, double radius, double startAngle, double endAngle, boolean counter-clockwise) | &emsp;&emsp;创建一条以`(x, y)`为圆心，以`radius`为半径，以`startAngle`与`endAngle`为起止角的圆弧路径。角的单位是弧度，不是角度( 180 角度 = π 弧度)。最后一个参数是可选的(true 就逆时针画弧)<br />&emsp; &emsp;如果在调用该方法时，当前路径中有子路径存在，那么浏览器就会将子路径的终点与所画圆弧的起点以线段相连 |
  | arcTo(double x1, double y1, double x2, double y2, double radius)                                      | &emsp;&emsp;参考`(x1, y1)`与`(x2, y2)`两个点，创建一条以`radius`为半径的圆弧路径。该圆弧与当前点懂啊`(x1, y1)`点的连线啊相切，同时也与`(x1, y1)`到`(x2, y2)`的连线相切。<br /> &emsp;&emsp; 如果在调用该方法时，当前路径中有子路径存在，那么浏览器就会将子路径的终点与所画圆弧的起点以线段相连                   |

- 贝塞尔曲线

| 方法                                                                                | 描述                                                                                                       |
| ----------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------- |
| quadraticCurveTo(double cpx, double cpy, double x, double y)                        | 创建一条表示二次方贝塞尔曲线的路径。该方法需要传入 2 个点，第一个是曲线的控制点，第二个是锚点              |
| bezierCurveTo(double cpx, double cpy, double cp2x, double cp2y, double x, double y) | 创建一条代表三次方贝塞尔曲线的路径。你需要向该方法传入三个点的坐标，前两点是该曲线的控制点，最后一个是锚点 |

[二次方贝塞尔曲线参考文档](https://www.w3school.com.cn/tags/canvas_quadraticcurveto.asp) &emsp;
[三次方贝塞尔曲线参考文档](https://www.w3school.com.cn/tags/canvas_beziercurveto.asp)

### 坐标变换

| 方法                           | 描述                                                                                                                                          |
| ------------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------- |
| rotate(double angleInRadians)  | 按照给定的角度来旋转坐标系 <br /> angle < 0,逆时针旋转 <br /> angle > 0, 顺时针旋转                                                           |
| scale(double x, double y)      | 在`X`与`Y`方向上分别按照给定的数值来缩放坐标系 <br > 会改变图形一下三点 <br /> 左上角坐标 <br /> 宽度或高度 <br /> 线条宽度                   |
| translate(double x, double y)  | 将坐标系平移到给定的`X`、`Y`坐标处                                                                                                            |
| transform(a, b, c, d, e, f)    | 说明：<br /> a: 水平缩放图 <br /> b: 水平倾斜绘图 <br /> c: 垂直倾斜绘图 <br /> d: 垂直缩放绘图 <br /> e: 水平移动绘图 <br /> f: 垂直移动绘图 |
| setTransform(a, b, c, d, e, f) | 与`transform`方法相似 <br /> transform: 每次调用，参考的都是上一次变换后的图形状态 <br /> setTransform: 会重置图形的状态，然后在进行变换      |

### 剪辑区域

| 方法     | 描述                                                                                                                                                                                                                                                                                                                                       |
| -------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `clip()` | 说明：使用`clip()`方法之前，必须要在 Canvas 中绘制一个基本图形。然后调用`clip()`方法。这个基本图形就会变为一个剪切区域。当我们使用`clip()`方法指定剪切区域后后，后面绘制的图形如果超过这个剪切区域，则超出部分不会被显示。 <br /><br /> `clip()`方法不支持 Canvas 自带的 2 个方法：`strokeRect()`和`fillRect()`，只能使用 rect()方法来代替 |

## 文本

1. 绘制文本的方法

   | 方法                                | 描述                                                                                                                                                |
   | ----------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------- |
   | `strokeText(text, x, y, maxWidth?)` | 可选的第 4 参数，该参数以像素为单位指定了所绘文本的最大宽度。(绘制的文本超过了此宽度，浏览器则会缩小文本的尺寸，使之符合调用方法时所指定的最大宽度) |
   | `fillText(text, x, y, maxWidth?)`   | ...                                                                                                                                                 |
   | `measureText(text)`                 | 该方法返回的对象中，包含一个名为`width`的属性，它的值代表你传递给该方法的文本所占据的宽度。                                                         |

2. 文本有关的属性

   | 方法           | 描述                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
   | -------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
   | `font`         | 规定字号字体                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
   | `textAlign`    | 设置或返回文本内容的当前对齐方式 <br /> `context.textAlign = "start"`(默认值，文本在指定的位置开始) <br /> `context.textAlign = "end"`(文本在指定的位置结束) <br /> `context.textAlign = "center"`(文本的中心被放置在指定的位置)<br /> `context.textAlign = "left"`(文本左对齐)<br /> `context.textAlign = "right"`(文本右对齐) <br />[参考文档](https://www.w3school.com.cn/tags/canvas_textalign.asp)                                                                                                                            |
   | `textBaseline` | 设置或返回在绘制文本时使用的当前文本基线 <br /> `context.textBaseline = "alphabetic"`(默认。文本基线是普通的字母基线)<br /> `context.textBaseline = "top"`(文本基线是`em`方框的顶端)<br /> `context.textBaseline = "hanging"`(文本基线是悬挂基线)<br /> `context.textBaseline = "middle"`(文本基线是`em`方框的正中)<br /> `context.textBaseline = "ideographic"`(文本基线是表意基线)<br /> `context.textBaseline = "bottom"`(文本基线是`em`方框的底端) <br /> [参考文档](https://www.w3school.com.cn/tags/canvas_textbaseline.asp) |

3. `font`属性的各个分量

   | 字型属性分量 | 有效取值                                                                                                                      |
   | ------------ | ----------------------------------------------------------------------------------------------------------------------------- |
   | font-style   | `normal`、`italic`、`oblique`                                                                                                 |
   | font-variant | 可以取 2 个值：`normal`、`small-caps`                                                                                         |
   | font-weight  | 决定该字型 、的字符笔画粗细，可取如下值：`normal`、`bold`、`bolder`、`lighter`、100、200、300……900                            |
   | font-size    | 字型的大小，可取如下值：`xx-small`、`x-small`、`medium`、`large`、`x-large`、`xx-large`、`smaller`、`larger`、`px`、`em`、`%` |
   | line-height  | &emsp;浏览器会将该属性强制设定为其默认值`normal`，如果你设置了该值，浏览器会忽略你所设定的值                                  |
   | font-family  | &emsp;可以用两种方式来设置字体集，一种方式是以`familly-name`,另一种是`generic-family`                                         |

## 图像的绘制

1. [绘制图像](https://www.w3school.com.cn/tags/canvas_drawimage.asp)

   | 方法 ---------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
   | `drawImage(HTMLImageElement image, double sx, double sy, double sw, double sh, double dx, double dy, double dw, double dh)` | 向`canvas`之中绘制的图像可以是一整幅，也可以是它的一部分，并且在绘制时有可能要对图像进行缩放。源图像中需要被绘制的区域是通过`sx`、`sy`、`sw`与`sh`参数来确定的，浏览器会根据`dw`与`dh`参数对所绘内容进行缩放。在该方法的各种用法中，只有前三个参数是必须的<br />&emsp;&emsp;`image` => 规定要使用的图像、画布或视频 <br /> &emsp;&emsp; `sx` => 开始剪切`x`坐标的位置 <br /> &emsp;&emsp; `sy` => 开始剪切的`y`坐标的位置 <br /> &emsp;&emsp; `sw` => 可选。被剪切图像的宽度 <br /> &emsp;&emsp; `sh` => 可选。被剪切图像的高度 <br /> &emsp;&emsp; `dx` => 在画布上放置图像的`x`坐标 <br /> &emsp;&emsp; `dy` => 在画布上放置图像的`y`坐标 <br /> &emsp;&emsp; `width` => 可选。要使用的图像的宽度(伸展或缩小图像) <br /> &emsp;&emsp; `height` => 可选。要使用的图像的高度。(伸展或缩小图像) |
   | 描述 |
   | -----------------------------------------

2. 操作图像

   | 方法                                                                                                                                                        | 描述                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
   | ----------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
   | `getImageData(in double sx, in double sy, in double sw, in double sh)`                                                                                      | &emsp;&emsp;返回一个`imageData`对象，该对象所含的数组具有`4 * w * h`个整数值，`w`和`h`表示以设备像素为单位的图像宽度与高度。可以通过`width`与`height`属性来访问该`imageData`对象的宽度和高度 <br /> &emsp;&nbsp;`imageData`对象所含的`data`数组中，每 4 个整数值代表 1 个像素，这些整数分别表示红、绿、蓝颜色分量，以及代表透明度的`alpha`值。<br /> &emsp;&emsp;请注意，该方法返回`ImageData`对象的宽度并不总是等于传递给它的宽度参数值。这是因为前者是以设备像素为单位，而后者则是以 CSS 像素为单位的 |
   | `putImageData(in ImageData imagedata, in double dx, in double dy, in optional double dirtyX, in double dirtyY, indouble dirtyWidth, in double dirtyHeight)` | &emsp;&emsp; 将图像数据绘制在`canvas`的`(dx, dy)`坐标处，该坐标是以 CSS 像素为单位的。后面 4 个参数所制定的脏矩形表示浏览器将会把这个矩形范围内的图像数据复制到屏幕`canvas`。指定该矩形时需以设备像素为单位                                                                                                                                                                                                                                                                                             |

## 动画

### 动画循环

| 方法                                     | 描述                                                                                                                          |
| ---------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------- |
| `window.requestAnimationFrame(callBack)` | 请求浏览器在绘制下一帧动画时调用指定的回调函数。若要取消回调，可将该方法所返回的句柄传递给`cancelRequestAnimationFrame()`方法 |
| `window.cancelRequestAnimationFrame()`   | 将原来以`requestAnimationFrame()`方法所注册的回调函数取消执行。必须在浏览器还没执行回调函数时才能调用此方法                   |
